---
title: FortiGate HA Active-Passive Clusterè¨­å®š
description: æœ¬ç¯‡æ•™å­¸å°‡èªªæ˜FortiGate HA Active-Passive Cluster ç›¸é—œè¨­å®šã€‚
date: 2025-05-05
categories:
  - Fortinet
tags:
  - FortiGate
  - HA
banner: img.png
comment: true
draft: true
---

<h2>ç›®éŒ„</h2>

- [1. HA åŸç†èˆ‡é‹ä½œæ¶æ§‹](#1-ha-åŸç†èˆ‡é‹ä½œæ¶æ§‹)
    - [1.1. FortiGate Clustering Protocolï¼ˆFGCPï¼‰èˆ‡åŒæ­¥æ¶æ§‹](#11-fortigate-clustering-protocolfgcpèˆ‡åŒæ­¥æ¶æ§‹)
        - [1.1.1. åŒæ­¥è³‡æ–™å…§å®¹](#111-åŒæ­¥è³‡æ–™å…§å®¹)
        - [1.1.2. å‚³è¼¸æ–¹å¼èˆ‡å°åŒ…å‹æ…‹](#112-å‚³è¼¸æ–¹å¼èˆ‡å°åŒ…å‹æ…‹)
        - [1.1.3. è¨­å®šåŒæ­¥åŠæ ¡é©—æ–¹å¼](#113-è¨­å®šåŒæ­¥åŠæ ¡é©—æ–¹å¼)
    - [1.2. Active-Passive æ¨¡å¼æµé‡èˆ‡è§’è‰²é‹ä½œ](#12-active-passive-æ¨¡å¼æµé‡èˆ‡è§’è‰²é‹ä½œ)
    - [1.3. VMAC èˆ‡ ARP ä¿ç•™æ©Ÿåˆ¶](#13-vmac-èˆ‡-arp-ä¿ç•™æ©Ÿåˆ¶)
    - [1.4. è§’è‰²é¸èˆ‰èˆ‡ Failover è¡Œç‚º](#14-è§’è‰²é¸èˆ‰èˆ‡-failover-è¡Œç‚º)
        - [1.4.1. Master / Backup è§’è‰²å®šç¾©èˆ‡åˆ‡æ›æ©Ÿåˆ¶](#141-master--backup-è§’è‰²å®šç¾©èˆ‡åˆ‡æ›æ©Ÿåˆ¶)
        - [1.4.2. è§’è‰²é¸èˆ‰æ©Ÿåˆ¶](#142-è§’è‰²é¸èˆ‰æ©Ÿåˆ¶)
            - [1.4.2.1. override å•Ÿç”¨](#1421-override-å•Ÿç”¨)
            - [1.4.2.2. override åœç”¨ï¼ˆé è¨­ï¼‰](#1422-override-åœç”¨é è¨­)
        - [1.4.3. å•Ÿç”¨ override æ–¹å¼](#143-å•Ÿç”¨-override-æ–¹å¼)
- [2. HA è¨­å®šæµç¨‹](#2-ha-è¨­å®šæµç¨‹)
    - [2.1. è¨­å®šéœ€æ±‚èˆ‡å‰ææ¢ä»¶](#21-è¨­å®šéœ€æ±‚èˆ‡å‰ææ¢ä»¶)
    - [2.3. è¨­å®šæ–¹å¼](#23-è¨­å®šæ–¹å¼)
    - [2.5. ä¸æœƒåŒæ­¥çš„è¨­å®šé …ç›®](#25-ä¸æœƒåŒæ­¥çš„è¨­å®šé …ç›®)
    - [2.6. 3.6 è§€å¯ŸåŒæ­¥ç‹€æ…‹èˆ‡ Cluster æˆå“¡](#26-36-è§€å¯ŸåŒæ­¥ç‹€æ…‹èˆ‡-cluster-æˆå“¡)
        - [2.6.1. CLI æª¢æŸ¥](#261-cli-æª¢æŸ¥)
        - [2.6.2. GUI æŸ¥çœ‹](#262-gui-æŸ¥çœ‹)
- [3. ç®¡ç†ä»‹é¢èˆ‡ç›£æ§æ•´åˆ](#3-ç®¡ç†ä»‹é¢èˆ‡ç›£æ§æ•´åˆ)
    - [3.1. Reserved Management Interfaceï¼ˆOOBï¼‰](#31-reserved-management-interfaceoob)
        - [3.1.1. CLI è¨­å®šç¯„ä¾‹](#311-cli-è¨­å®šç¯„ä¾‹)
        - [3.1.2. é…åˆæ¯å°æˆå“¡è¨­å®šè©²ä»‹é¢ IPï¼ˆä¸æœƒåŒæ­¥ï¼‰](#312-é…åˆæ¯å°æˆå“¡è¨­å®šè©²ä»‹é¢-ipä¸æœƒåŒæ­¥)
        - [3.1.3. æ³¨æ„äº‹é …](#313-æ³¨æ„äº‹é …)
        - [3.1.4. GUI è¨­å®šä½ç½®](#314-gui-è¨­å®šä½ç½®)
    - [3.2. In-band Managementï¼ˆé€é management-ipï¼‰](#32-in-band-managementé€é-management-ip)
        - [3.2.1. CLI è¨­å®š](#321-cli-è¨­å®š)
    - [3.3. ha-direct çš„åŠŸèƒ½èˆ‡ç”¨é€”](#33-ha-direct-çš„åŠŸèƒ½èˆ‡ç”¨é€”)
        - [3.3.1. CLI å•Ÿç”¨](#331-cli-å•Ÿç”¨)
        - [3.3.2. SNMP ç¯„ä¾‹è¨­å®š](#332-snmp-ç¯„ä¾‹è¨­å®š)
    - [3.4. GUI è¨­å®šèˆ‡ SNMP/FortiAnalyzer æ•´åˆèªªæ˜](#34-gui-è¨­å®šèˆ‡-snmpfortianalyzer-æ•´åˆèªªæ˜)
        - [3.4.1. Reserved IP é¡¯ç¤ºä½ç½®](#341-reserved-ip-é¡¯ç¤ºä½ç½®)
        - [3.4.2. æ—¥èªŒ / Trap æµå‘è¡Œç‚º](#342-æ—¥èªŒ--trap-æµå‘è¡Œç‚º)
    - [3.5. ç®¡ç†ä»‹é¢é¸æ“‡å»ºè­°](#35-ç®¡ç†ä»‹é¢é¸æ“‡å»ºè­°)
- [4. å‡ç´š](#4-å‡ç´š)
    - [4.1. Uninterrupted Upgradeï¼ˆé è¨­ï¼‰](#41-uninterrupted-upgradeé è¨­)
        - [4.1.1. æµç¨‹èªªæ˜](#411-æµç¨‹èªªæ˜)
        - [4.1.2. ç‰¹æ€§](#412-ç‰¹æ€§)
        - [4.1.3. æ­¥é©Ÿ](#413-æ­¥é©Ÿ)
    - [4.2. Interrupted Upgradeï¼ˆéé è¨­ï¼‰](#42-interrupted-upgradeéé è¨­)
        - [4.2.1. æµç¨‹èªªæ˜](#421-æµç¨‹èªªæ˜)
        - [4.2.2. ç‰¹æ€§](#422-ç‰¹æ€§)
        - [4.2.3. æ­¥é©Ÿ](#423-æ­¥é©Ÿ)
- [5. HA ç¶­è­·æ“ä½œ](#5-ha-ç¶­è­·æ“ä½œ)
    - [5.1. æ‰‹å‹•è§’è‰²åˆ‡æ›ï¼šFailover æ¸¬è©¦èˆ‡æ§åˆ¶](#51-æ‰‹å‹•è§’è‰²åˆ‡æ›failover-æ¸¬è©¦èˆ‡æ§åˆ¶)
        - [5.1.1. CLI è§¸ç™¼è§’è‰²åˆ‡æ›ï¼š](#511-cli-è§¸ç™¼è§’è‰²åˆ‡æ›)
        - [5.1.2. GUI æ“ä½œï¼ˆåƒ… Master å¯åŸ·è¡Œï¼‰](#512-gui-æ“ä½œåƒ…-master-å¯åŸ·è¡Œ)
    - [5.2. æˆå“¡è„«é›¢ / åŠ å…¥ cluster çš„è™•ç†](#52-æˆå“¡è„«é›¢--åŠ å…¥-cluster-çš„è™•ç†)
        - [5.2.1. è„«é›¢ HA](#521-è„«é›¢-ha)
        - [5.2.2. åŠ å…¥ HA](#522-åŠ å…¥-ha)
    - [5.3. å–®æ©Ÿç¶­ä¿®ã€æ›¿æ›è¨­å‚™çš„å®‰å…¨è™•ç†](#53-å–®æ©Ÿç¶­ä¿®æ›¿æ›è¨­å‚™çš„å®‰å…¨è™•ç†)
        - [5.3.1. å»ºè­°ä½œæ³•](#531-å»ºè­°ä½œæ³•)
    - [5.4. é—œéµ CLI è¨ºæ–·æŒ‡ä»¤](#54-é—œéµ-cli-è¨ºæ–·æŒ‡ä»¤)
        - [5.4.1. æŸ¥çœ‹ cluster ç‹€æ…‹](#541-æŸ¥çœ‹-cluster-ç‹€æ…‹)
        - [5.4.2. æª¢æŸ¥åŒæ­¥ checksum å·®ç•°](#542-æª¢æŸ¥åŒæ­¥-checksum-å·®ç•°)
        - [5.4.3. é¡¯ç¤º heartbeat å°åŒ…çµ±è¨ˆ](#543-é¡¯ç¤º-heartbeat-å°åŒ…çµ±è¨ˆ)
        - [5.4.4. å¿ƒè·³å°åŒ…å°é–åˆ†æï¼ˆæŠ“å°åŒ…ï¼‰](#544-å¿ƒè·³å°åŒ…å°é–åˆ†ææŠ“å°åŒ…)

## 1. HA åŸç†èˆ‡é‹ä½œæ¶æ§‹

FortiGate çš„ High Availabilityï¼ˆHAï¼‰åŠŸèƒ½å¯å°‡å¤šå°è¨­å‚™çµ„æˆ clusterï¼Œä»¥å¯¦ç¾æ•…éšœè½‰ç§»èˆ‡ä¸ä¸­æ–·çš„æœå‹™ã€‚Active-Passive æ¨¡å¼ä¸­ï¼Œåƒ… Master è£ç½®è™•ç†æµé‡ï¼Œå…¶é¤˜ç‚ºå‚™æ´è§’è‰²ï¼ˆBackupï¼‰ï¼Œä»¥ä¾¿åœ¨ç™¼ç”Ÿæ•…éšœæ™‚è‡ªå‹•æ¥æ‰‹ã€‚

### 1.1. FortiGate Clustering Protocolï¼ˆFGCPï¼‰èˆ‡åŒæ­¥æ¶æ§‹

FortiGate ä½¿ç”¨ **FortiGate Clustering Protocol (FGCP)** åœ¨ HA æˆå“¡é–“é€²è¡Œè§’è‰²å”èª¿èˆ‡è³‡æ–™åŒæ­¥ã€‚

#### 1.1.1. åŒæ­¥è³‡æ–™å…§å®¹

Master æœƒåŒæ­¥ä»¥ä¸‹è³‡æ–™è‡³æ‰€æœ‰ Backup æˆå“¡ï¼š

- è¨­å®šæª”ï¼ˆconfigï¼‰
- Session è¡¨ï¼ˆè¦– session-pickup è¨­å®šè€Œå®šï¼‰
- è£ç½®å¥åº·ç‹€æ…‹ï¼ˆå¦‚ uptimeã€daemon ç‹€æ…‹ã€ä»‹é¢ç‹€æ…‹ï¼‰

é€™äº›è³‡è¨Šé€é heartbeat port å‚³è¼¸ï¼Œç¢ºä¿ Backup èƒ½åœ¨æ•…éšœç™¼ç”Ÿæ™‚ç„¡ç¸«æ¥æ‰‹ã€‚

#### 1.1.2. å‚³è¼¸æ–¹å¼èˆ‡å°åŒ…å‹æ…‹

HA ä½¿ç”¨ä¸åŒæ–¹å¼é€²è¡Œç‹€æ…‹åŒæ­¥èˆ‡ session å‚³è¼¸ï¼Œå‚³è¼¸æ–¹å¼å¦‚ä¸‹ï¼š

| åŠŸèƒ½é¡å‹                | èªªæ˜                                                                                    |
| ----------------------- | --------------------------------------------------------------------------------------- |
| **Heartbeat**           | ä½¿ç”¨ Layer 2 broadcast å°åŒ…ï¼ŒEtherType `0x8890`                                         |
| **Session åŒæ­¥**        | ä½¿ç”¨ UDP/708 å‚³è¼¸ï¼Œå°åŒ…å°è£ç‚º EtherType `0x8892`ï¼ˆæŒ‡å®šä»‹é¢ï¼‰æˆ– `0x8893`ï¼ˆé è¨­ï¼‰         |
| **è¨­å®šåŒæ­¥ / CLI æ§åˆ¶** | ä½¿ç”¨ Telnet over FGCP å°åŒ…ï¼ŒEtherType `0x8893`ï¼Œå‚³é€è¨­å®šè®Šæ›´èˆ‡ `execute ha manage` æŒ‡ä»¤ |

!!! info
    è‹¥éƒ¨ç½²æ–¼ VM æˆ– Cloud ç’°å¢ƒï¼ŒL2 Broadcast å¯èƒ½è¢«é˜»æ“‹ï¼Œå»ºè­°å•Ÿç”¨ `unicast-hb`ï¼Œæ”¹ä»¥ Layer 3 å‚³è¼¸ heartbeat å°åŒ…ã€‚

#### 1.1.3. è¨­å®šåŒæ­¥åŠæ ¡é©—æ–¹å¼

**è¨­å®šè®Šæ›´åŒæ­¥**

ç•¶ç®¡ç†è€…åœ¨ Master ä¸Šé€²è¡Œè¨­å®šè®Šæ›´ï¼Œè®Šæ›´æœƒ**ç«‹å³åŒæ­¥**è‡³æ‰€æœ‰ Backup æˆå“¡

**ä¸€è‡´æ€§æ ¡é©—**

- ç³»çµ±æœƒæ¯ **60 ç§’** æª¢æŸ¥ cluster æˆå“¡é–“çš„è¨­å®š checksum
- è‹¥ç™¼ç¾ Backup çš„ checksum ä¸ä¸€è‡´ï¼Œæ”¹ç‚ºæ¯ **15 ç§’** æª¢æŸ¥ä¸€æ¬¡
- è‹¥é€£çºŒ **5 æ¬¡ checksum æª¢æŸ¥çš†ä¸ä¸€è‡´** â†’ è§¸ç™¼ **Full Sync**ï¼Œé‡å‚³æ•´ä»½è¨­å®šæª”

### 1.2. Active-Passive æ¨¡å¼æµé‡èˆ‡è§’è‰²é‹ä½œ

| è§’è‰²   | åŠŸèƒ½èªªæ˜                                   |
| ------ | ------------------------------------------ |
| Master | è™•ç†æ‰€æœ‰é€²å‡ºæµé‡ã€åŒæ­¥è¨­å®šã€ç¶­æŒæœƒè©±       |
| Backup | ä¸è™•ç†æµé‡ï¼Œåªæ”¶è¨­å®šèˆ‡ç‹€æ…‹è³‡è¨Šï¼Œå¿…è¦æ™‚æ¥æ‰‹ |

åˆ‡æ›æ¢ä»¶è§¸ç™¼å¾Œï¼ˆå¦‚ master æ•…éšœã€é€£ç·šä¸­æ–·ï¼‰ï¼ŒBackup æˆç‚ºæ–°çš„ Master æ¥æ‰‹æœå‹™ã€‚æœƒè©±æ˜¯å¦ä¿ç•™ï¼Œä¾ session pickup è¨­å®šè€Œå®šã€‚

### 1.3. VMAC èˆ‡ ARP ä¿ç•™æ©Ÿåˆ¶

HA ä¸­å„ä»‹é¢æœƒå¥—ç”¨è™›æ“¬ MACï¼ˆVMACï¼‰ï¼Œæ ¼å¼ç‚ºï¼š

```text
00-09-0f-09-xx-xx
```

å…¶ä¸­ `xx-xx` éƒ¨åˆ†ç”± group-id ç·¨ç¢¼ã€‚ä½¿ç”¨ VMAC çš„å¥½è™•ï¼š

- è§’è‰²åˆ‡æ›å¾Œ IP-MAC å°æ‡‰ä¸è®Šï¼Œé¿å… ARP æ›´æ–°å»¶é²
- å¯å¿«é€Ÿåˆ‡æ›è€Œä¸å½±éŸ¿å‘¨é‚Šç¶²è·¯è£ç½®

### 1.4. è§’è‰²é¸èˆ‰èˆ‡ Failover è¡Œç‚º

#### 1.4.1. Master / Backup è§’è‰²å®šç¾©èˆ‡åˆ‡æ›æ©Ÿåˆ¶

| è§’è‰²   | èªªæ˜                                           |
| ------ | ---------------------------------------------- |
| Master | å”¯ä¸€è™•ç†æ‰€æœ‰è³‡æ–™æµã€è² è²¬åŒæ­¥å…¶ä»–æˆå“¡è¨­å®šèˆ‡ç‹€æ…‹ |
| Backup | ä¸è™•ç†æµé‡ï¼Œåƒ…åŒæ­¥ Master è³‡æ–™ï¼Œå¾…å‘½ä»¥å‚™æ¥æ‰‹   |

ç•¶ Master è£ç½®ç™¼ç”Ÿæ•…éšœæˆ–ä»‹é¢ä¸­æ–·ï¼ˆä¾ç›£æ§è¨­å®šï¼‰ï¼ŒBackup æœƒå•Ÿå‹•è§’è‰²é¸èˆ‰æ©Ÿåˆ¶ä¸¦æ¥æ‰‹ç‚ºæ–°çš„ Masterã€‚  
è§’è‰²è½‰æ›å¾Œï¼Œæ–°çš„ Master å°‡è™•ç†æµé‡ï¼Œä¸¦ç¹¼çºŒå‘å…¶ä»–æˆå“¡åŒæ­¥è³‡æ–™ã€‚

---

#### 1.4.2. è§’è‰²é¸èˆ‰æ©Ÿåˆ¶

Fortinet HA Cluster çš„ä¸»æ©Ÿï¼ˆMasterï¼‰é¸èˆ‰è¡Œç‚ºï¼Œæœƒä¾æ“š `override` è¨­å®šæ–¹å¼è€Œæœ‰ä¸åŒé‚è¼¯èˆ‡æ’åºæ¢ä»¶ï¼š

---

##### 1.4.2.1. override å•Ÿç”¨

- è‹¥ Master çš„ `priority` è¢«æ‰‹å‹•èª¿ä½ï¼Œæˆ–å…¶ä»–æˆå“¡ `priority` è¼ƒé«˜ï¼Œå°‡å¯èƒ½**è§¸ç™¼è§’è‰²åˆ‡æ›**
- ç•¶åŸ Master æ¢å¾©é€£ç·šï¼Œè‹¥å…¶ `priority` è¼ƒé«˜ï¼Œæœƒ**é‡æ–°æ¥ä»» Master**
- é©åˆéœ€ã€Œå›ºå®šè¨­å‚™æ“”ä»» masterã€çš„æƒ…å¢ƒ

è§’è‰²é¸æ“‡é †åºå¦‚ä¸‹ï¼š

1. **Monitored Interface ç‹€æ…‹**
2. **Priority**
3. **HA uptime**
4. **Serial numberï¼ˆåºè™Ÿï¼‰**

---

##### 1.4.2.2. override åœç”¨ï¼ˆé è¨­ï¼‰

- å³ä½¿ `priority` ç™¼ç”Ÿè®Šå‹•ï¼Œä¹Ÿ**ä¸æœƒå› æ­¤è§¸ç™¼è§’è‰²åˆ‡æ›**
- é¿å…åè¦†åˆ‡æ›è§’è‰²ï¼Œæå‡æ•´é«”ç©©å®šæ€§
- é©åˆå¸Œæœ›ç¶­æŒç©©å®š master è§’è‰²çš„éƒ¨ç½²å ´æ™¯

è§’è‰²é¸æ“‡é †åºå¦‚ä¸‹ï¼š

1. **Monitored Interface ç‹€æ…‹**
2. **HA uptime**
3. **Priority**
4. **Serial numberï¼ˆåºè™Ÿï¼‰**

!!! note
    - **HA uptime** æ˜¯è¨­å‚™è‡ªä¸Šæ¬¡ HA äº‹ä»¶ï¼ˆå¦‚ failoverã€é‡å•Ÿï¼‰ä»¥ä¾†çš„é‹è¡Œæ™‚é–“ã€‚
    - ç•¶å€™é¸è¨­å‚™ä¹‹é–“çš„ HA uptime å·®ç•°å°æ–¼ 300 ç§’ï¼ˆ5 åˆ†é˜ï¼‰æ™‚ï¼Œç³»çµ±å°‡å¿½ç•¥ uptime æ¯”è¼ƒï¼Œæ”¹æ¯”è¼ƒ priorityã€‚
    - ç„¡è«–æ˜¯å¦å•Ÿç”¨ overrideï¼Œ**Monitored Interface ç‹€æ…‹çš†ç‚ºé¦–è¦ä¾æ“š**ã€‚

!!! tip
    è‹¥è¦æŸ¥è©¢ **å„æˆå“¡çš„ HA uptimeï¼ˆå½±éŸ¿è§’è‰²é¸èˆ‰ï¼‰**ï¼Œè«‹ä½¿ç”¨ä¸‹åˆ— CLI æŒ‡ä»¤ï¼š
    ```shell
    diagnose sys ha dump-by group
    ```
    ç¯„ä¾‹è¼¸å‡ºï¼š

    **æ¯”è¼ƒæ¬„ä½ç‚ºuptime/reset_cnt=6586/0ä¸­çš„uptime**
    ```shell
                HA information.
    group-id=0, group-name='cluster1'
    has_no_aes128_gcm_sha256_member=0

    gmember_nr=2
    'FW1': ha_ip_idx=1, hb_packet_version=6, last_hb_jiffies=6686140, linkfails=24, weight/o=0/0, support_aes128_gcm_sha256=1
            hbdev_nr=2: port23(mac=7478..a4, last_hb_jiffies=6686140, hb_lost=0), port24(mac=7478..a5, last_hb_jiffies=6686140, hb_lost=0), 
    'FW2': ha_ip_idx=0, hb_packet_version=28, last_hb_jiffies=0, linkfails=0, weight/o=0/0, support_aes128_gcm_sha256=1

    vcluster_nr=1
    vcluster-1: start_time=1747108373(2025-05-13 11:52:53), state/o/chg_time=3(standby)/2(work)/1747101788(2025-05-13 10:03:08)
            pingsvr_flip_timeout/expire=3600s/0s
            'FW1': ha_prio/o=0/0, link_failure=0, pingsvr_failure=0, flag=0x00000001, mem_failover=0, uptime/reset_cnt=6586/0
            'FW2': ha_prio/o=1/1, link_failure=0, pingsvr_failure=0, flag=0x00000002, mem_failover=0, uptime/reset_cnt=0/3
    ```

    é è¨­è‹¥å…©å°è¨­å‚™HA uptime å·®ç•°å°æ–¼ 300 ç§’ï¼Œç³»çµ±å°‡å¿½ç•¥ uptime æ¯”è¼ƒï¼Œé€²å…¥ä¸‹ä¸€é¸æ“‡æ¢ä»¶ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ä¿®æ”¹ã€‚
    ```shell
    config system ha
    set ha-uptime-diff-margin <value>
    end 
    ```

    ğŸ“Œ èˆ‡ `get system performance status` ä¸­çš„ uptimeï¼ˆç³»çµ±é–‹æ©Ÿæ™‚é–“ï¼‰ä¸åŒï¼Œé¸èˆ‰ç”¨çš„æ˜¯é€™è£¡çš„ **HA uptime**ã€‚

#### 1.4.3. å•Ÿç”¨ override æ–¹å¼

å¯é€é CLI é–‹å•Ÿ overrideï¼š

```shell
config system ha
    set override enable
end
```

## 2. HA è¨­å®šæµç¨‹

### 2.1. è¨­å®šéœ€æ±‚èˆ‡å‰ææ¢ä»¶

åœ¨é–‹å§‹è¨­å®š HA å‰ï¼Œè«‹ç¢ºèªä»¥ä¸‹æ¢ä»¶å·²ç¬¦åˆï¼š

| é …ç›®              | è¦æ±‚                                        |
| ----------------- | ------------------------------------------- |
| å‹è™Ÿ              | æ‰€æœ‰ HA æˆå“¡å¿…é ˆç‚ºç›¸åŒå‹è™Ÿ                  |
| éŸŒé«”ç‰ˆæœ¬          | æ‰€æœ‰æˆå“¡éœ€ç‚ºå®Œå…¨ç›¸åŒç‰ˆæœ¬èˆ‡ build            |
| VDOM è¨­å®š         | è‹¥å•Ÿç”¨ VDOMï¼Œçµæ§‹èˆ‡ VDOM åç¨±éœ€ä¸€è‡´         |
| HA group-nameã€ID | æ‰€æœ‰æˆå“¡éœ€è¨­å®šç›¸åŒçš„ group-name èˆ‡ group-id |
| HA å¯†ç¢¼           | éœ€ä¸€è‡´ï¼Œå¦å‰‡ç„¡æ³•åŠ å…¥ cluster                |

### 2.3. è¨­å®šæ–¹å¼

è‡³`System > HA`è¨­å®š

| æ¬„ä½åç¨±             | èªªæ˜                                                                 |
| -------------------- | -------------------------------------------------------------------- |
| Mode                 | é¸æ“‡ Active-Passive                                                  |
| Device Priority      | æ•¸å€¼è¶Šé«˜è€…è¶Šå„ªå…ˆ                                                     |
| Group Name           | ç¾¤çµ„åç¨±ï¼Œæ‰€æœ‰è¨­å‚™éœ€ç›¸åŒ                                             |
| Group ID             | ç”¨æ–¼ VMAC ç·¨ç¢¼ï¼Œæ‰€æœ‰è¨­å‚™éœ€ç›¸åŒ                                       |
| Password             | ç¾¤çµ„é©—è­‰å¯†ç¢¼ï¼Œæ‰€æœ‰è¨­å‚™éœ€ç›¸åŒ                                         |
| Override             | å•Ÿç”¨å¾Œç•¶Monitored Interfacesç‹€æ…‹ä¸€è‡´å‰‡priorityè¼ƒé«˜è€…æœƒæˆç‚ºmaster         |
| Heartbeat Interfaces | ç”¨æ–¼åŒæ­¥è¨­å®šã€sessionåŠç›£æ§å°ç«¯å­˜æ´»ç‹€æ…‹ï¼Œå»ºè­°è¨­ 2 æ¢ä»¥ä¸Šé¿å…å–®é»å¤±æ•— |
| Monitored Interfaces | è¨­å®šç›£æ§å“ªäº›ä»‹é¢ï¼Œç•¶ç›£æ§çš„ä»‹é¢downæ™‚å°‡æœƒè§¸ç™¼ha failover              |
| Session Pickup       | æ˜¯å¦åŒæ­¥sessionï¼Œå»ºè­°`å•Ÿç”¨`ä»¥é™ä½sessionä¸­æ–·æƒ…å½¢                     |

ç•¶ç¬¬äºŒå°ï¼ˆBackupï¼‰è¨­å®šå¥½ç›¸åŒ group-nameã€group-idã€password ä¸¦é€£ä¸Š heartbeat port å¾Œï¼š

- æœƒèˆ‡ç¾æœ‰ cluster æˆå“¡è‡ªå‹•å»ºç«‹é€šè¨Š
- è‹¥é€šéé©—è­‰ï¼Œæœƒè‡ªå‹•åŠ å…¥ cluster
- **å…¶åŸæœ‰è¨­å®šï¼ˆé™¤ HA æœ¬èº«ï¼‰æœƒè¢« Master è¦†è“‹**

!!! warning
    åŠ å…¥ HA å¾Œï¼Œå‚™æ©Ÿçš„è¨­å®šåƒ…ä¿ç•™ï¼š
    - `config system ha`
    - Reserved port çš„ IPï¼ˆå¦‚ç®¡ç†ç”¨ï¼‰
    - hostnameã€priorityï¼ˆä¸æœƒåŒæ­¥ï¼‰

---

### 2.5. ä¸æœƒåŒæ­¥çš„è¨­å®šé …ç›®

åŠ å…¥ HA ç¾¤çµ„å¾Œï¼Œä»¥ä¸‹è¨­å®šã€Œä¸æœƒåŒæ­¥ã€ï¼š

| é …ç›®              | èªªæ˜                                      |
| ----------------- | ----------------------------------------- |
| Hostname          | æ¯å°è¨­å‚™å¯ä¸åŒ                            |
| Device priority   | é ˆå€‹åˆ¥è¨­å®š                                |
| management-ip     | åƒ…é©ç”¨æ–¼ in-band ç®¡ç†ï¼Œæ‰‹å‹•è¨­å®š           |
| reserved port IP  | æ¯å°æˆå“¡ç®¡ç†ä»‹é¢ IPï¼Œé ˆè‡ªè¡Œè¨­             |
| interface comment | ä»‹é¢æè¿°ä¸æœƒåŒæ­¥                          |
| FortiToken        | âœ… å”¯ä¸€æœƒè‡ªå‹•å¾ Master åŒæ­¥çš„ä¾‹å¤–æˆæ¬Šé …ç›® |

---

### 2.6. 3.6 è§€å¯ŸåŒæ­¥ç‹€æ…‹èˆ‡ Cluster æˆå“¡

#### 2.6.1. CLI æª¢æŸ¥

```shell
get system ha status
```

- é¡¯ç¤º cluster IDã€Master/Backupã€priorityã€sync status

```shell
diagnose sys ha checksum show
```

- æ¯”è¼ƒ config checksumï¼Œç¢ºèªåŒæ­¥æ˜¯å¦æˆåŠŸ

#### 2.6.2. GUI æŸ¥çœ‹

`Dashboard > Status > System Information > HA Status`  
é»æ“Šå¾Œå¯æŸ¥çœ‹æˆå“¡æ¸…å–®ã€ç‹€æ…‹èˆ‡è§’è‰²ã€åŒæ­¥ç‹€æ³ã€‚

## 3. ç®¡ç†ä»‹é¢èˆ‡ç›£æ§æ•´åˆ

åœ¨ FortiGate HA ç’°å¢ƒä¸­ï¼Œé è¨­åƒ… Master æˆå“¡è™•ç†æ‰€æœ‰è³‡æ–™æµèˆ‡ç®¡ç†æµé‡ï¼ˆå¦‚ SNMP Trapã€Syslogã€FortiAnalyzer Logs ç­‰ï¼‰ã€‚ç‚ºäº†é”åˆ°å€‹åˆ¥ç®¡ç†èˆ‡ç›£æ§éœ€æ±‚ï¼Œéœ€æ­£ç¢ºé…ç½® Reserved æˆ– In-band ç®¡ç†ä»‹é¢ï¼Œä¸¦å•Ÿç”¨ `ha-direct` åŠŸèƒ½ã€‚

### 3.1. Reserved Management Interfaceï¼ˆOOBï¼‰

**Reserved Interface** æ˜¯åœ¨ HA æ¶æ§‹ä¸­ï¼Œæ¯å°æˆå“¡éƒ½ä½¿ç”¨ç¨ç«‹çš„å¯¦é«”ä»‹é¢èˆ‡ IP ä¾†é€²è¡Œç®¡ç†ç”¨é€”ï¼Œé€™äº›ä»‹é¢ä¸åƒèˆ‡è³‡æ–™æµé‡ã€‚

#### 3.1.1. CLI è¨­å®šç¯„ä¾‹

```shell
config system ha
    set ha-mgmt-status enable
    set ha-direct enable
    config ha-mgmt-interfaces
        edit 1
            set interface "port8"
            set gateway 192.168.100.1
        next
    end
end
```

#### 3.1.2. é…åˆæ¯å°æˆå“¡è¨­å®šè©²ä»‹é¢ IPï¼ˆä¸æœƒåŒæ­¥ï¼‰

```shell
config system interface
edit "port8"
    set ip 192.168.100.11 255.255.255.0
    set allowaccess ping https ssh snmp
next
end
```

#### 3.1.3. æ³¨æ„äº‹é …

- è©² IP éœ€è¨­å®šç‚ºéœæ…‹ï¼Œä¸èƒ½ DHCP
- gateway è¨­å®šæœƒåŠ é€² routing tableï¼Œå¯èƒ½å½±éŸ¿è³‡æ–™è·¯ç”±
- å»ºè­°æ’é™¤è©²ä»‹é¢æ–¼ routing èˆ‡ policy ä¸­ï¼Œåƒ…åšç®¡ç†ä½¿ç”¨

#### 3.1.4. GUI è¨­å®šä½ç½®

`System > HA` â†’ Enable Reserved Management Interface  
æ¥è‘—æ–¼å„æˆå“¡è¨­å®šå„è‡ª IP â†’ `Network > Interfaces > portX`

---

### 3.2. In-band Managementï¼ˆé€é management-ipï¼‰

è‹¥æ²’æœ‰é¡å¤–ç®¡ç† portï¼Œä¹Ÿå¯é€éä¸»æµé‡ä»‹é¢æŒ‡å®šã€Œåƒ…ä¾›ç®¡ç†ä½¿ç”¨ã€çš„ IPã€‚

#### 3.2.1. CLI è¨­å®š

```shell
config system ha
    set management-ip 192.168.10.11 255.255.255.0
end
```

- è©² IP ä¸åƒèˆ‡ routingï¼Œåƒ…ä¾› GUI/SSH/SNMP ä½¿ç”¨
- å„æˆå“¡éœ€å€‹åˆ¥è¨­å®šä¸åŒ IP
- ä¸å¯é€éæ­¤ IP ç™¼é€ log unless `ha-direct` enabled

---

### 3.3. ha-direct çš„åŠŸèƒ½èˆ‡ç”¨é€”

é è¨­æƒ…æ³ä¸‹ï¼Œåªæœ‰ Master è£ç½®èƒ½ï¼š

- å‚³é€ SNMP Trap
- ç™¼é€ Syslogã€FAZ log
- å•Ÿå‹• FortiCloudã€NTP ç­‰æœå‹™æµé‡

è‹¥è¦è®“ Backup æˆå“¡ä¹Ÿèƒ½ç™¼é€é€™äº›æµé‡ï¼Œ**å¿…é ˆå•Ÿç”¨ `ha-direct`** ä¸¦æ­é… Reserved Interface æˆ– management-ipã€‚

#### 3.3.1. CLI å•Ÿç”¨

```shell
config system ha
    set ha-direct enable
end
```

#### 3.3.2. SNMP ç¯„ä¾‹è¨­å®š

```shell
config system snmp community
edit 1
    set name "monitor"
    config hosts
        edit 1
            set ip 192.168.100.200 255.255.255.255
            set ha-direct enable
        next
    end
next
end
```

!!! warning
    è‹¥æœªè¨­å®š `ha-direct enable`ï¼ŒBackup å³ä½¿æœ‰ IP ä¹Ÿä¸æœƒå•Ÿå‹• SNMP agent æˆ–å‚³é€ trapã€‚

---

### 3.4. GUI è¨­å®šèˆ‡ SNMP/FortiAnalyzer æ•´åˆèªªæ˜

#### 3.4.1. Reserved IP é¡¯ç¤ºä½ç½®

- `Dashboard > Status > HA Status` â†’ æ¯å°æˆå“¡çš„ reserved IP
- `Network > Interfaces > portX` â†’ å¯è¨­å®š admin access èˆ‡ allowaccess

#### 3.4.2. æ—¥èªŒ / Trap æµå‘è¡Œç‚º

| åŠŸèƒ½             | ha-direct æœªå•Ÿç”¨ï¼ˆé è¨­ï¼‰ | ha-direct å•Ÿç”¨            |
| ---------------- | ------------------------ | ------------------------- |
| Syslog           | åƒ…ç”± Master å‚³å‡º         | å„æˆå“¡å¯ç¨ç«‹å‚³é€          |
| FortiAnalyzer    | åƒ…ç”± Master å‚³é€         | å„æˆå“¡å¯è‡ªè¡Œä¸Šå‚³ log      |
| SNMP æŸ¥è©¢        | åƒ… Master å›æ‡‰           | å„è‡ªè£ç½®å¯è¢«æŸ¥è©¢ã€ç™¼ Trap |
| NTP / FortiCloud | ç”± Master ç™¼é€           | å„è£ç½®å¯è‡ªè¡Œä¸Šç¶²åŒæ­¥      |

---

### 3.5. ç®¡ç†ä»‹é¢é¸æ“‡å»ºè­°

| æ–¹å¼          | é©ç”¨æƒ…å¢ƒ             | å„ªé»                   | æ³¨æ„äº‹é …                          |
| ------------- | -------------------- | ---------------------- | --------------------------------- |
| Reserved Port | è³‡æºå…è¨± / å¯¦é«”å……è¶³  | ç®¡ç†æµé‡éš”é›¢ã€å®‰å…¨æ€§é«˜ | éœ€é¡å¤– portã€IPã€å¯èƒ½å½±éŸ¿ routing |
| In-band IP    | Port æœ‰é™ / å°å‹éƒ¨ç½² | ç„¡éœ€é¡å¤–ä»‹é¢ï¼Œéƒ¨ç½²å¿«é€Ÿ | ä¸åƒèˆ‡è·¯ç”±ã€éœ€æ­é… ha-direct ä½¿ç”¨ |

!!! tip
    è‹¥æœ‰ SNMPã€FAZã€Syslog ç­‰éœ€æ±‚ï¼Œå»ºè­°ä½¿ç”¨ Reserved Interface ä¸¦å•Ÿç”¨ `ha-direct`ï¼Œå¯å¤§å¹…æå‡ç›£æ§å¯è¦‹åº¦ã€‚

---

## 4. å‡ç´š

åœ¨ FortiGate HA æ¶æ§‹ä¸­ï¼Œå‡ç´šæ–¹å¼è‹¥è¦åŠƒæ­£ç¢ºï¼Œèƒ½åœ¨ä¸ä¸­æ–·æœå‹™çš„æƒ…æ³ä¸‹å®Œæˆã€‚Fortinet æä¾›å…©ç¨®å‡ç´šæ©Ÿåˆ¶ï¼š

- **Uninterrupted Upgradeï¼ˆä¸ä¸­æ–·å‡ç´šï¼‰**ï¼šé è¨­å•Ÿç”¨ï¼Œè®“ cluster è‡ªå‹•åˆ†éšæ®µå‡ç´šï¼Œç›¡é‡ä¸ä¸­æ–·æµé‡
- **Interrupted Upgradeï¼ˆä¸­æ–·å‡ç´šï¼‰**ï¼šå¯æ‰‹å‹•åˆ‡æ›æ¨¡å¼ï¼Œæ‰€æœ‰æˆå“¡æœƒåŒæ™‚é‡å•Ÿï¼Œæœå‹™æš«åœ

---

### 4.1. Uninterrupted Upgradeï¼ˆé è¨­ï¼‰

#### 4.1.1. æµç¨‹èªªæ˜

FortiGate çš„ HA å‡ç´šæµç¨‹æœƒè‡ªå‹•è™•ç†ä¸»å¾åˆ‡æ›èˆ‡åŒæ­¥ï¼Œæ•´é«”éç¨‹å¦‚ä¸‹ï¼š

1. ä½¿ç”¨è€…é€é GUI å°‡æ–° firmware ä¸Šå‚³è‡³ç›®å‰çš„ Master è£ç½®
2. Master æœƒ**å…ˆè®“æ‰€æœ‰å‚™æ©Ÿï¼ˆsubordinateï¼‰è‡ªå‹•å‡ç´š**
3. å‡ç´šå®Œæˆå¾Œï¼Œ**å…¶ä¸­ä¸€å°å‚™æ©Ÿæœƒè‡ªå‹•æ¥ä»» Master**
4. åŸæœ¬çš„ Master æ¥è‘—å‡ç´šï¼Œå‡ç´šæœŸé–“ä¸è™•ç†æµé‡
5. æœ€å¾Œï¼Œç³»çµ±æœƒæ ¹æ“š HA è¦å‰‡å†é¸å‡ºä¸€å°è£ç½®ä½œç‚ºæ–°çš„ Masterï¼Œå®Œæˆæ•´å€‹å‡ç´šç¨‹åº

#### 4.1.2. ç‰¹æ€§

- TCP æµé‡å¯ä¿ç•™ä¸ä¸­æ–·ï¼ˆéœ€å•Ÿç”¨ session pickupï¼‰
- å‡ç´šéç¨‹è‡ªå‹•åˆ‡æ›è§’è‰²
    - è‹¥ `override` é—œé–‰ï¼ˆé è¨­ï¼‰ï¼ŒåŸ Master å‡ç´šå¾Œé€šå¸¸ä¸æœƒå†æ¬¡æˆç‚º Masterï¼ˆå›  uptime é‡ç½®ï¼‰
    - è‹¥ `override` å•Ÿç”¨ä¸” priority è¼ƒé«˜ï¼ŒåŸ Master å‡ç´šå¾Œå°‡é‡æ–°æ¥ä»» Masterï¼Œæœƒç™¼ç”Ÿç¬¬äºŒæ¬¡è§’è‰²åˆ‡æ›
- å‡ç´šå¾Œçš„æˆå“¡è‡ªå‹•èˆ‡åŸè¨­å®šåŒæ­¥ï¼Œç„¡éœ€æ‰‹å‹•æ¯”å°è¨­å®šæª”

#### 4.1.3. æ­¥é©Ÿ

1. ç™»å…¥ç›®å‰ Master çš„ Web GUI
2. å‰å¾€ `System > Firmware`
3. é»é¸å³ä¸Šè§’ **Upgrade Cluster**
4. é¸æ“‡å‡ç´šä¾†æºï¼ˆFortiGuardã€æœ¬åœ°æª”æ¡ˆç­‰ï¼‰
5. ç³»çµ±è‡ªå‹•åŸ·è¡Œ Rolling å‡ç´šæµç¨‹ï¼Œé¡¯ç¤ºå„æˆå“¡ç‹€æ…‹

### 4.2. Interrupted Upgradeï¼ˆéé è¨­ï¼‰

#### 4.2.1. æµç¨‹èªªæ˜

è‹¥ä½ ä¸å¸Œæœ› HA cluster è‡ªå‹•å‡ç´šèˆ‡åˆ‡æ›è§’è‰²ï¼Œå¯æ”¹ç”¨ã€Œä¸­æ–·å‡ç´šã€æ¨¡å¼ï¼Œéç¨‹å¦‚ä¸‹ï¼š

1. ä½¿ç”¨è€…æ‰‹å‹•å°‡ firmware å‡ç´šè¨­å®šç‚ºã€Œä¸ä¿ç•™æµé‡ä¸ä¸­æ–·ã€
2. å‡ç´šæœƒåŒæ™‚ç™¼é€è‡³æ‰€æœ‰æˆå“¡
3. æ‰€æœ‰è£ç½®æœƒ**åŒæ™‚é€²è¡Œå‡ç´šèˆ‡é‡é–‹æ©Ÿ**
4. é–‹æ©Ÿå®Œæˆå¾Œè‡ªå‹•é‡æ–°å»ºç«‹ HA Clusterï¼Œé‡æ–°é¸å‡º Master

!!! warning
    å‡ç´šæœŸé–“æ‰€æœ‰è¨­å‚™çš†æœƒåŒæ™‚é›¢ç·šï¼Œå°‡**é€ æˆæµé‡ä¸­æ–·èˆ‡æœå‹™æš«åœ**ã€‚  
    åƒ…é©ç”¨æ–¼å¯ä»¥å®¹å¿åœæ©Ÿçš„ç¶­è­·æ™‚æ®µã€‚

#### 4.2.2. ç‰¹æ€§

- ç„¡å‡ç´šæ’åºæ©Ÿåˆ¶ï¼Œæ‰€æœ‰æˆå“¡**åŒæ™‚å‡ç´šèˆ‡é‡å•Ÿ**
- ä¸é€²è¡Œä¸»å¾è§’è‰²åˆ‡æ›
- å‡ç´šéç¨‹ä¸­æœƒä¸­æ–·æ‰€æœ‰è³‡æ–™æµèˆ‡é€£ç·š
- é©ç”¨æ–¼ç„¡éœ€é«˜å¯ç”¨ä¿è­·çš„æ¸¬è©¦/éç‡Ÿé‹æ™‚æ®µ

#### 4.2.3. æ­¥é©Ÿ

1. ç™»å…¥ CLIï¼Œåœç”¨ä¸ä¸­æ–·å‡ç´šæ¨¡å¼ï¼š
```shell
config system ha
    set uninterruptible-upgrade disable
end
```
2. ä¸Šå‚³ firmware è‡³ Master è£ç½®
3. é€é GUI åŸ·è¡Œå‡ç´šï¼Œæ‰€æœ‰ HA æˆå“¡å°‡åŒæ­¥å‡ç´šèˆ‡é‡å•Ÿ
4. è£ç½®é‡å•Ÿå¾Œï¼Œè‡ªå‹•é‡æ–°å½¢æˆ HA cluster

## 5. HA ç¶­è­·æ“ä½œ

HA æ¶æ§‹é›–å¯è‡ªå‹•åµæ¸¬ä¸¦åˆ‡æ›ï¼Œä½†åœ¨å¯¦å‹™ç¶­è­·æˆ–å‡ç´šéç¨‹ä¸­ï¼Œä»å»ºè­°ä½¿ç”¨ CLI æˆ– GUI æŒ‡ä»¤é€²è¡Œã€Œæ‰‹å‹•æ§åˆ¶ã€ï¼Œä»¥é¿å…éé æœŸåˆ‡æ›ï¼Œæˆ–åœ¨æ›´æ›è¨­å‚™æ™‚ä¿ç•™ cluster ç©©å®šæ€§ã€‚

---

### 5.1. æ‰‹å‹•è§’è‰²åˆ‡æ›ï¼šFailover æ¸¬è©¦èˆ‡æ§åˆ¶

è‹¥éœ€é©—è­‰ session pickup æˆ–æ¸¬è©¦æ–°è¨­å‚™èƒ½å¦æ¥æ‰‹ï¼Œå»ºè­°é€é CLI é€²è¡Œæ‰‹å‹•åˆ‡æ›ï¼š

#### 5.1.1. CLI è§¸ç™¼è§’è‰²åˆ‡æ›ï¼š

```shell
diagnose sys ha switch
```

- Backup æœƒå‡ç‚º Masterï¼ŒåŸ Master æˆç‚º Backup
- å¯¦å‹™å¸¸ç”¨æ–¼ï¼š
  - æ–°æ©Ÿæ¸¬è©¦èƒ½å¦æ‰¿æ¥ session
  - å‡ç´šå¾ŒåŠŸèƒ½é©—è­‰

#### 5.1.2. GUI æ“ä½œï¼ˆåƒ… Master å¯åŸ·è¡Œï¼‰

`System > HA` â†’ é»é¸ `Force Switch`  
ï¼ˆåƒ…åœ¨æŸäº› FortiOS ç‰ˆæœ¬é–‹æ”¾ï¼Œè¦– GUI æ¬Šé™èˆ‡è§’è‰²è€Œå®šï¼‰

---

### 5.2. æˆå“¡è„«é›¢ / åŠ å…¥ cluster çš„è™•ç†

#### 5.2.1. è„«é›¢ HA

```shell
config system ha
    set mode standalone
end
```

- è©²è¨­å‚™æœƒç«‹å³é€€å‡º HA ç¾¤çµ„ï¼Œconfig å°‡ä¿ç•™ç¾ç‹€ï¼ˆä¸å†å—åŒæ­¥å½±éŸ¿ï¼‰
- é©ç”¨æ–¼å‡ç´šã€æª¢ä¿®ã€æ›´æ›è¨­å‚™

#### 5.2.2. åŠ å…¥ HA

é‡æ–°è¨­å®š HA åƒæ•¸èˆ‡ä¸»ç¯€é»ç›¸åŒï¼š

```shell
config system ha
    set mode a-p
    set group-name "cluster1"
    set group-id 1
    set password MyPW
    set priority 100
end
```

- åŠ å…¥å¾Œï¼ŒMaster æœƒè¦†è“‹è©²è¨­å‚™çš„è¨­å®šï¼ˆåƒ…ä¿ç•™ hostnameã€priorityã€reserved IP ç­‰ï¼‰

!!! warning
    åŠ å…¥å¾Œè³‡æ–™æœƒè‡ªå‹•åŒæ­¥ï¼ŒåŸæœ‰è¨­å®šå°‡è¢«è¦†è“‹ï¼ˆé™¤ç‰¹å®šå€å¡Šï¼‰


### 5.3. å–®æ©Ÿç¶­ä¿®ã€æ›¿æ›è¨­å‚™çš„å®‰å…¨è™•ç†

#### 5.3.1. å»ºè­°ä½œæ³•

1. æ‰‹å‹•åˆ‡æ› Master è‡³å¦ä¸€å°è¨­å‚™ï¼ˆ`diagnose sys ha switch`ï¼‰
2. å¾…ç¶­ä¿®è¨­å‚™è½‰ç‚º Backup ä¸”ä¸è™•ç†æµé‡
3. å°‡å…¶å¾ cluster ç§»é™¤
4. åŸ·è¡Œç¶­ä¿®æˆ–æ›¿æ›ï¼ˆFirmwareã€ç¡¬é«”æª¢æŸ¥ç­‰ï¼‰
5. ç¢ºèªåŠŸèƒ½æ­£å¸¸å¾Œï¼Œé‡æ–°è¨­å®šä¸¦åŠ å…¥ HA
6. è¦–éœ€è¦å†åˆ‡å›åŸ Master

!!! tip
    å»ºè­°ä½¿ç”¨ç®¡ç† IP ç™»å…¥ç¶­ä¿®è¨­å‚™ï¼Œé¿å…é€é floating IP ç™¼å‡ºå¹²æ“¾æ€§å°åŒ…

### 5.4. é—œéµ CLI è¨ºæ–·æŒ‡ä»¤

#### 5.4.1. æŸ¥çœ‹ cluster ç‹€æ…‹

```shell
get system ha status
```

- é¡¯ç¤ºè§’è‰²ï¼ˆMaster/Backupï¼‰ã€priorityã€cluster uptimeã€sync status

#### 5.4.2. æª¢æŸ¥åŒæ­¥ checksum å·®ç•°

```shell
diagnose sys ha checksum show
```

- è‹¥ checksum ä¸ä¸€è‡´ï¼Œå¯èƒ½éœ€æ‰‹å‹•åŒæ­¥æˆ–æ’æŸ¥è¨­å®šå·®ç•°

#### 5.4.3. é¡¯ç¤º heartbeat å°åŒ…çµ±è¨ˆ

```shell
diagnose sys ha showhb
```

- å¯è§€å¯Ÿæ¯å€‹ heartbeat port çš„æ”¶ç™¼ç‹€æ³

#### 5.4.4. å¿ƒè·³å°åŒ…å°é–åˆ†æï¼ˆæŠ“å°åŒ…ï¼‰

```shell
diagnose sniffer packet any 'ether proto 0x8890' 4
```

- è‹¥çœ‹ä¸åˆ°å°åŒ…ï¼Œä»£è¡¨å¿ƒè·³è¢« L2 ç¶²è·¯æ“‹ä½æˆ–æœªé€šé VLAN/STP